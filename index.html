<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Epidemic Diseases Act Quiz (511 MCQs)</title>
  <meta name="description" content="Flashcard-style quiz on the Epidemic Diseases Act, 1897 ‚Äì 511 questions with scoring, shuffle, and sections."/>
  <!-- Tailwind CSS via CDN for quick GitHub Pages setup -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* minimal extras */
    .card { @apply bg-white dark:bg-slate-800 rounded-2xl shadow-lg p-6 border border-slate-200 dark:border-slate-700; }
    .btn { @apply inline-flex items-center justify-center rounded-xl px-4 py-2 font-medium shadow-sm border border-slate-300 dark:border-slate-600 hover:shadow-md transition active:scale-[0.99]; }
    .btn-primary { @apply bg-indigo-600 text-white border-indigo-600 hover:bg-indigo-700; }
    .btn-ghost { @apply bg-transparent border-slate-300 dark:border-slate-600; }
    .tag { @apply text-xs font-semibold tracking-wide px-2 py-1 rounded-full; }
    .tag-sec { @apply bg-indigo-50 text-indigo-700 dark:bg-indigo-900/40 dark:text-indigo-200; }
    .toggle { @apply relative inline-flex h-6 w-11 shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2; }
    .toggle-dot { @apply pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-indigo-50 to-sky-50 dark:from-slate-900 dark:to-slate-950 text-slate-900 dark:text-slate-100">
  <div class="max-w-6xl mx-auto p-4 sm:p-8">
    <header class="mb-6 sm:mb-10 flex items-center justify-between gap-4">
      <div>
        <h1 class="text-2xl sm:text-3xl font-bold">Epidemic Diseases Act Quiz</h1>
        <p class="text-sm sm:text-base text-slate-600 dark:text-slate-300">511 flashcard‚Äëstyle questions ‚Ä¢ MCQ (single & multi‚Äëselect) ‚Ä¢ Score at the end ‚Ä¢ Shuffle toggle ‚Ä¢ Section filter</p>
      </div>
      <div class="flex items-center gap-3">
        <!-- Shuffle toggle -->
        <label class="flex items-center gap-3 select-none">
          <span class="text-sm font-medium">Shuffle</span>
          <input id="shuffleToggle" type="checkbox" class="hidden" />
          <span id="shuffleUI" class="toggle bg-slate-200" role="switch" aria-checked="false">
            <span class="toggle-dot translate-x-0"></span>
          </span>
        </label>
        <!-- Theme toggle (fun!) -->
        <button id="themeBtn" class="btn btn-ghost" title="Toggle dark mode" aria-label="Toggle dark mode">üåó</button>
      </div>
    </header>

    <!-- Controls -->
    <section class="card mb-6">
      <div class="grid sm:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-semibold mb-1">Section</label>
          <select id="sectionSelect" class="w-full rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 p-2">
          </select>
          <p class="mt-2 text-xs text-slate-600 dark:text-slate-400">Distribute or focus by topic. ‚ÄúAll Sections‚Äù uses a balanced mix.</p>
        </div>
        <div class="grid grid-cols-2 sm:grid-cols-3 gap-2 content-start">
          <div>
            <label class="block text-sm font-semibold mb-1">Number of Questions</label>
            <input id="numQuestions" type="number" min="5" max="511" value="25" class="w-full rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 p-2"/>
            <p class="mt-1 text-xs text-slate-600 dark:text-slate-400">Up to 511.</p>
          </div>
          <div>
            <label class="block text-sm font-semibold mb-1">Mode</label>
            <select id="modeSelect" class="w-full rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 p-2">
              <option value="mixed">Mixed (MCQ & Multi‚Äëselect)</option>
              <option value="single">Single‚Äëselect only</option>
              <option value="multi">Multi‚Äëselect only</option>
              <option value="tf">True/False</option>
            </select>
          </div>
          <div class="flex items-end">
            <button id="startBtn" class="btn btn-primary w-full">Start Quiz</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Quiz area -->
    <section id="quizArea" class="hidden">
      <div class="card mb-4">
        <div class="flex items-center justify-between mb-4">
          <div class="flex items-center gap-2 text-sm">
            <span id="progressTag" class="tag tag-sec">Q <span id="qIndex">1</span>/<span id="qTotal">25</span></span>
            <span class="tag tag-sec" id="sectionTag"></span>
          </div>
          <div class="text-sm">Score: <span id="liveScore">0</span></div>
        </div>
        <h2 id="questionText" class="text-lg font-semibold mb-4"></h2>
        <div id="optionsWrap" class="grid sm:grid-cols-2 gap-2"></div>
        <div id="feedback" class="mt-3 text-sm"></div>
        <div class="mt-4 flex items-center justify-between gap-2">
          <button id="prevBtn" class="btn btn-ghost">‚óÄ Prev</button>
          <div class="flex items-center gap-2">
            <button id="checkBtn" class="btn btn-primary">Check</button>
            <button id="nextBtn" class="btn btn-ghost">Next ‚ñ∂</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Results -->
    <section id="resultArea" class="hidden">
      <div class="card">
        <h3 class="text-xl font-bold mb-2">Your Score</h3>
        <p class="text-slate-600 dark:text-slate-300 mb-4">You scored <span id="finalScore" class="font-bold">0</span> out of <span id="finalTotal">0</span> (<span id="finalPct">0</span>%).</p>
        <div class="grid sm:grid-cols-2 gap-4 mb-4">
          <div class="card">
            <h4 class="font-semibold mb-2">By Section</h4>
            <ul id="sectionBreakdown" class="space-y-1 text-sm"></ul>
          </div>
          <div class="card">
            <h4 class="font-semibold mb-2">Review Answers</h4>
            <div id="reviewList" class="space-y-3 max-h-72 overflow-auto pr-2"></div>
          </div>
        </div>
        <div class="flex items-center gap-2">
          <button id="retryBtn" class="btn">Retry</button>
          <button id="newQuizBtn" class="btn btn-primary">New Quiz</button>
        </div>
      </div>
    </section>

    <footer class="mt-10 text-center text-xs text-slate-500 dark:text-slate-400">
      <p>Made for GitHub Pages ‚Ä¢ Single‚Äëfile, no build step. ü™Ñ</p>
    </footer>
  </div>

  <script>
    // -----------------------------
    // DATA MODEL (generated 511 Qs)
    // -----------------------------
    const BASE_TOPICS = [
      'Meaning under the Epidemic Diseases Act, 1897',
      'Concept under the Act',
      'Definition under the Act',
      'Powers of Central Government',
      'Protection for healthcare personnel and damage to property',
      'Compensation',
      'Investigation into offences',
      'Trial and penalties',
      'Epidemic Diseases (Amendment) Ordinance, 2020'
    ];

    const BASE_SUMMARIES = {
      'Meaning under the Epidemic Diseases Act, 1897': 'Purpose and scope: grants governments special powers to control dangerous epidemic diseases and take swift measures.',
      'Concept under the Act': 'Empowers authorities to impose preventive controls like quarantine, inspection, and restrictions to curb spread.',
      'Definition under the Act': 'The Act does not expressly define "epidemic disease"; refers broadly to dangerous diseases requiring immediate control.',
      'Powers of Central Government': 'Authority to regulate sea/port measures, interstate spread prevention, and other steps to contain disease.',
      'Protection for healthcare personnel and damage to property': '2020 changes protect healthcare workers from violence and property damage while on duty.',
      'Compensation': 'Provides compensation for damage/loss to healthcare workers‚Äô property due to violence/obstruction during duty.',
      'Investigation into offences': 'Certain offences (e.g., violence against healthcare workers) are cognizable, non‚Äëbailable, and investigated swiftly.',
      'Trial and penalties': 'Prescribes imprisonment and fines for violating regulations; stricter punishments for violence (months to years).',
      'Epidemic Diseases (Amendment) Ordinance, 2020': 'Strengthened protections, set faster investigations, and harsher penalties; safeguarded healthcare infrastructure.'
    };

    // Utility: generate unique combos of topics up to size 3 (for clean multi‚Äëselect) + add synthetic variants to reach 511.
    function generateQuestionBank(target = 511) {
      const combos = new Set();
      const list = [];

      // 1-topic combos
      for (const a of BASE_TOPICS) combos.add(JSON.stringify([a]));
      // 2-topic combos (unordered)
      for (let i=0;i<BASE_TOPICS.length;i++) {
        for (let j=i+1;j<BASE_TOPICS.length;j++) {
          combos.add(JSON.stringify([BASE_TOPICS[i], BASE_TOPICS[j]]));
        }
      }
      // 3-topic combos (unordered) ‚Äî keep it reasonable for MCQ multi‚Äëselect
      for (let i=0;i<BASE_TOPICS.length;i++) {
        for (let j=i+1;j<BASE_TOPICS.length;j++) {
          for (let k=j+1;k<BASE_TOPICS.length;k++) {
            combos.add(JSON.stringify([BASE_TOPICS[i], BASE_TOPICS[j], BASE_TOPICS[k]]));
          }
        }
      }

      // Build initial questions from combos
      [...combos].forEach(str => {
        const topics = JSON.parse(str);
        const primary = topics[0];
        list.push(makeQuestionFromTopics(topics, primary));
      });

      // If below target, add T/F and single‚Äëselect variants per topic
      let idx = 0;
      while (list.length < target) {
        const t = BASE_TOPICS[idx % BASE_TOPICS.length];
        // Alternate variants
        list.push(makeSingleSelectFromSummary(t));
        if (list.length < target) list.push(makeTrueFalseVariant(t, true));
        if (list.length < target) list.push(makeTrueFalseVariant(t, false));
        idx++;
      }

      // Trim to exact target
      return list.slice(0, target);
    }

    function shuffleInPlace(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }

    function sample(arr, n){ const copy=[...arr]; shuffleInPlace(copy); return copy.slice(0,n); }

    // Create a multi‚Äëselect (checkbox) MCQ from a set of correct topics
    function makeQuestionFromTopics(correctTopics, primarySection){
      // Pick distractors so that options are between 4 and 6 checkboxes
      const distractors = BASE_TOPICS.filter(t=>!correctTopics.includes(t));
      const extra = sample(distractors, Math.max(0, Math.min(6 - correctTopics.length, 3)));
      const options = shuffleInPlace([...correctTopics, ...extra]).slice(0, Math.max(4, correctTopics.length));
      return {
        type: (correctTopics.length === 1 ? 'single' : 'multi'),
        section: primarySection,
        stem: `Select the topic(s) covered by this prompt: ‚ÄúExplain ${correctTopics.join(' and ')} under the Epidemic Diseases Act, 1897.‚Äù`,
        options: options,
        correct: new Set(correctTopics)
      };
    }

    // Create a single‚Äëselect: given a summary, ask which topic it describes
    function makeSingleSelectFromSummary(topic){
      const wrong = sample(BASE_TOPICS.filter(t=>t!==topic), 3);
      const opts = shuffleInPlace([topic, ...wrong]);
      return {
        type: 'single',
        section: topic,
        stem: `Which topic is best described by: ‚Äú${BASE_SUMMARIES[topic]}‚Äù`,
        options: opts,
        correct: new Set([topic])
      };
    }

    // True/False variant using a swapped summary
    function makeTrueFalseVariant(topic, truthy){
      const other = sample(BASE_TOPICS.filter(t=>t!==topic), 1)[0];
      const statement = truthy ? BASE_SUMMARIES[topic] : BASE_SUMMARIES[other];
      return {
        type: 'single',
        section: topic,
        stem: `True or False: The following statement refers to <${topic}> ‚Äî ‚Äú${statement}‚Äù`,
        options: ['True','False'],
        correct: new Set([ truthy ? 'True' : 'False' ])
      };
    }

    // -----------------------------
    // APP STATE
    // -----------------------------
    let QUESTION_BANK = generateQuestionBank(511);
    let quiz = [];
    let idx = 0;
    let score = 0;
    let checked = new Map(); // index -> selected options (Set)
    let perSection = {}; // section -> {correct, total}

    // DOM refs
    const shuffleToggle = document.getElementById('shuffleToggle');
    const shuffleUI = document.getElementById('shuffleUI');
    const sectionSelect = document.getElementById('sectionSelect');
    const numQuestions = document.getElementById('numQuestions');
    const startBtn = document.getElementById('startBtn');
    const quizArea = document.getElementById('quizArea');
    const resultArea = document.getElementById('resultArea');
    const qIndex = document.getElementById('qIndex');
    const qTotal = document.getElementById('qTotal');
    const sectionTag = document.getElementById('sectionTag');
    const questionText = document.getElementById('questionText');
    const optionsWrap = document.getElementById('optionsWrap');
    const feedback = document.getElementById('feedback');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const checkBtn = document.getElementById('checkBtn');
    const liveScore = document.getElementById('liveScore');
    const finalScore = document.getElementById('finalScore');
    const finalTotal = document.getElementById('finalTotal');
    const finalPct = document.getElementById('finalPct');
    const sectionBreakdown = document.getElementById('sectionBreakdown');
    const reviewList = document.getElementById('reviewList');
    const retryBtn = document.getElementById('retryBtn');
    const newQuizBtn = document.getElementById('newQuizBtn');
    const modeSelect = document.getElementById('modeSelect');

    // Populate section select
    function fillSections() {
      sectionSelect.innerHTML = '';
      const optAll = document.createElement('option');
      optAll.value = 'ALL';
      optAll.textContent = 'All Sections';
      sectionSelect.appendChild(optAll);
      BASE_TOPICS.forEach(t => {
        const o = document.createElement('option');
        o.value = t; o.textContent = t; sectionSelect.appendChild(o);
      });
    }
    fillSections();

    // Shuffle UI behavior
    shuffleUI.addEventListener('click', ()=>{
      shuffleToggle.checked = !shuffleToggle.checked;
      syncShuffleUI();
    });
    function syncShuffleUI(){
      if (shuffleToggle.checked){
        shuffleUI.classList.remove('bg-slate-200');
        shuffleUI.classList.add('bg-indigo-600');
        shuffleUI.setAttribute('aria-checked','true');
        shuffleUI.querySelector('.toggle-dot').classList.add('translate-x-5');
      } else {
        shuffleUI.classList.add('bg-slate-200');
        shuffleUI.classList.remove('bg-indigo-600');
        shuffleUI.setAttribute('aria-checked','false');
        shuffleUI.querySelector('.toggle-dot').classList.remove('translate-x-5');
      }
    }
    syncShuffleUI();

    // Theme toggle
    const themeBtn = document.getElementById('themeBtn');
    const preferDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    if (localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && preferDark)) {
      document.documentElement.classList.add('dark');
    }
    themeBtn.addEventListener('click', ()=>{
      document.documentElement.classList.toggle('dark');
      localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
    });

    function buildQuiz() {
      // filter by section
      let pool = [...QUESTION_BANK];
      const sec = sectionSelect.value;
      const mode = modeSelect.value;

      if (sec !== 'ALL') pool = pool.filter(q => q.section === sec);

      // filter by mode
      if (mode === 'single') pool = pool.filter(q => q.type === 'single');
      if (mode === 'multi') pool = pool.filter(q => q.type === 'multi');
      if (mode === 'tf') pool = pool.filter(q => q.options.length === 2);

      if (shuffleToggle.checked) shuffleInPlace(pool);

      const N = Math.min(parseInt(numQuestions.value || '25', 10), pool.length);

      // Balanced distribution across sections when ALL selected
      if (sec === 'ALL') {
        const per = Math.max(1, Math.floor(N / BASE_TOPICS.length));
        const bySec = Object.fromEntries(BASE_TOPICS.map(s => [s, pool.filter(q => q.section === s)]));
        const arr = [];
        let cursor = 0;
        // round‚Äërobin draw
        while (arr.length < N) {
          for (const s of BASE_TOPICS) {
            const pick = bySec[s][cursor];
            if (pick) arr.push(pick);
            if (arr.length >= N) break;
          }
          cursor++;
        }
        quiz = arr.slice(0,N);
      } else {
        quiz = pool.slice(0, N);
      }

      // reset state
      idx = 0; score = 0; checked = new Map(); perSection = {};
      BASE_TOPICS.forEach(s => perSection[s] = {correct:0,total:0});
      quiz.forEach(q => perSection[q.section].total++);

      qTotal.textContent = quiz.length;
      liveScore.textContent = score;
      quizArea.classList.remove('hidden');
      resultArea.classList.add('hidden');

      renderQuestion();
    }

    function renderQuestion() {
      const q = quiz[idx];
      qIndex.textContent = String(idx + 1);
      sectionTag.textContent = q.section;
      questionText.textContent = q.stem;
      optionsWrap.innerHTML = '';
      feedback.textContent = '';

      const prevSel = checked.get(idx) || new Set();
      const isMulti = (q.type === 'multi') || (q.correct.size > 1);

      q.options.forEach(opt => {
        const id = 'opt_' + idx + '_' + opt.replace(/[^a-z0-9]/gi,'');
        const label = document.createElement('label');
        label.className = 'flex gap-2 items-start p-3 rounded-xl border border-slate-300 dark:border-slate-600 hover:shadow cursor-pointer';
        const input = document.createElement('input');
        input.type = isMulti ? 'checkbox' : 'radio';
        input.name = 'q' + idx;
        input.value = opt;
        input.className = 'mt-1';
        input.id = id;
        if (prevSel.has(opt)) input.checked = true;
        const span = document.createElement('span');
        span.innerHTML = '<span class="font-medium">' + opt + '</span>';
        label.appendChild(input); label.appendChild(span);
        optionsWrap.appendChild(label);
      });
    }

    function getCurrentSelection(){
      const q = quiz[idx];
      const isMulti = (q.type === 'multi') || (q.correct.size > 1);
      const inputs = optionsWrap.querySelectorAll(isMulti ? 'input[type=checkbox]' : 'input[type=radio]');
      const sel = new Set();
      inputs.forEach(i => { if (i.checked) sel.add(i.value); });
      return sel;
    }

    function setsEqual(a,b){ if (a.size !== b.size) return false; for (const v of a){ if (!b.has(v)) return false; } return true; }

    function checkAnswer(){
      const q = quiz[idx];
      const sel = getCurrentSelection();
      checked.set(idx, sel);

      const correct = setsEqual(sel, q.correct);
      const corrList = [...q.correct].join(', ');
      if (correct) {
        feedback.innerHTML = `<span class="text-green-700 dark:text-green-400 font-semibold">Correct!</span> ‚úÖ`;
        if (!q.counted) { score++; q.counted = true; perSection[q.section].correct++; }
      } else {
        feedback.innerHTML = `<span class="text-rose-700 dark:text-rose-400 font-semibold">Not quite.</span> Correct answer: <em>${corrList}</em>`;
      }
      liveScore.textContent = score;
    }

    function showResults(){
      quizArea.classList.add('hidden');
      resultArea.classList.remove('hidden');
      finalScore.textContent = score;
      finalTotal.textContent = quiz.length;
      finalPct.textContent = Math.round((score/quiz.length)*100);

      // section breakdown
      sectionBreakdown.innerHTML = '';
      BASE_TOPICS.forEach(s => {
        if (perSection[s].total>0){
          const li = document.createElement('li');
          const pct = Math.round((perSection[s].correct / perSection[s].total) * 100);
          li.textContent = `${s}: ${perSection[s].correct}/${perSection[s].total} (${pct}%)`;
          sectionBreakdown.appendChild(li);
        }
      });

      // Review list
      reviewList.innerHTML = '';
      quiz.forEach((q, i) => {
        const div = document.createElement('div');
        div.className = 'border-l-4 pl-3';
        const sel = checked.get(i) || new Set();
        const you = [...sel].join(', ') || '‚Äî';
        const corr = [...q.correct].join(', ');
        const ok = setsEqual(sel, q.correct);
        div.innerHTML = `<div class="text-xs text-slate-500 mb-1">Q${i+1} ‚Ä¢ ${q.section}</div>
          <div class="font-medium mb-1">${q.stem}</div>
          <div class="text-sm">Your answer: <span class="${ok?'text-green-700 dark:text-green-400':'text-rose-700 dark:text-rose-400'}">${you}</span></div>
          <div class="text-sm">Correct: <em>${corr}</em></div>`;
        reviewList.appendChild(div);
      });
    }

    // Events
    startBtn.addEventListener('click', buildQuiz);
    prevBtn.addEventListener('click', ()=>{ if (idx>0){ idx--; renderQuestion(); } });
    nextBtn.addEventListener('click', ()=>{
      if (idx < quiz.length - 1){ idx++; renderQuestion(); } else { showResults(); }
    });
    checkBtn.addEventListener('click', checkAnswer);
    retryBtn.addEventListener('click', ()=>{ idx = 0; score = 0; checked = new Map(); BASE_TOPICS.forEach(s => perSection[s] = {correct:0,total:0}); quiz.forEach(q => { q.counted=false; perSection[q.section].total++; }); quizArea.classList.remove('hidden'); resultArea.classList.add('hidden'); renderQuestion(); liveScore.textContent = score; });
    newQuizBtn.addEventListener('click', ()=>{ quizArea.classList.add('hidden'); resultArea.classList.add('hidden'); });
  </script>
</body>
</html>
